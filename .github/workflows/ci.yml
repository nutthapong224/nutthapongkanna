name: PR Test (CI)

on:
  pull_request:
    branches: [ main ]

jobs:
  run-tests:
    name: Run Unit Tests
    runs-on: ubuntu-latest

    steps:
      - name: ğŸ§¾ Checkout code
        uses: actions/checkout@v4

      - name: ğŸ“¢ à¹à¸ªà¸”à¸‡à¸£à¸²à¸¢à¸¥à¸°à¹€à¸­à¸µà¸¢à¸”à¸‚à¸±à¹‰à¸™à¸•à¸­à¸™
        run: |
          echo "=============================================="
          echo "ğŸš€ à¹€à¸£à¸´à¹ˆà¸¡à¸à¸£à¸°à¸šà¸§à¸™à¸à¸²à¸£à¸•à¸£à¸§à¸ˆà¸ªà¸­à¸š Pull Request (PR)"
          echo "à¸£à¸°à¸šà¸šà¸—à¸³à¸‡à¸²à¸™à¸­à¸±à¸•à¹‚à¸™à¸¡à¸±à¸•à¸´:"
          echo "1. à¸•à¸´à¸”à¸•à¸±à¹‰à¸‡ dependency (pip install -r requirements.txt)"
          echo "2. à¸£à¸±à¸™ unit tests"
          echo "3. à¸•à¸£à¸§à¸ˆà¸ªà¸­à¸šà¸§à¹ˆà¸² test à¸œà¹ˆà¸²à¸™à¸—à¸±à¹‰à¸‡à¸«à¸¡à¸”"
          echo "4. à¹à¸ªà¸”à¸‡à¸œà¸¥ â€œPassedâ€ à¸«à¸£à¸·à¸­ â€œFailedâ€ à¹ƒà¸™à¸«à¸™à¹‰à¸² PR"
          echo ""
          echo "ğŸ¯ à¸œà¸¥à¸¥à¸±à¸à¸˜à¹Œà¸—à¸µà¹ˆà¸„à¸²à¸”à¸«à¸§à¸±à¸‡:"
          echo "â€¢ à¹€à¸¡à¸·à¹ˆà¸­à¹€à¸›à¸´à¸” PR â†’ à¸£à¸°à¸šà¸šà¸£à¸±à¸™à¸—à¸±à¸™à¸—à¸µ"
          echo "â€¢ à¸–à¹‰à¸² test à¸œà¹ˆà¸²à¸™ â†’ à¹à¸ªà¸”à¸‡à¸ªà¸–à¸²à¸™à¸° âœ… Passed"
          echo "â€¢ à¸–à¹‰à¸² test à¸¥à¹‰à¸¡à¹€à¸«à¸¥à¸§ â†’ à¹à¸ªà¸”à¸‡à¸ªà¸–à¸²à¸™à¸° âŒ Failed à¹à¸¥à¸° merge à¹„à¸¡à¹ˆà¹„à¸”à¹‰"
          echo "=============================================="

      - name: ğŸ Set up Python 3.12
        uses: actions/setup-python@v5
        with:
          python-version: "3.12"

      - name: ğŸ“¦ Install dependencies
        run: |
          echo "ğŸ”§ à¸à¸³à¸¥à¸±à¸‡à¸•à¸´à¸”à¸•à¸±à¹‰à¸‡ dependencies..."
          python -m pip install --upgrade pip
          pip install -r requirements.txt

      - name: ğŸ§ª Run unit tests with pytest
        run: |
          echo "ğŸ§ª à¹€à¸£à¸´à¹ˆà¸¡à¸£à¸±à¸™à¸—à¸”à¸ªà¸­à¸š..."
          echo "----------------------------------------"

          if pytest -v; then
            echo ""
            echo "âœ… success"
          else
            echo ""
            echo "âŒ failedâ€ à¹à¸¥à¸° merge à¹„à¸¡à¹ˆà¹„à¸”à¹‰"
            exit 1
          fi
